{% extends "layout.html" %}

{% block body %}

    <form action="{{ url_for('go_walk') }}" method="post">
        <div class="choose">Choose starting point:</div>
        <div class="form-group">
            <select class="selectpicker show-tick" name="start" data-live-search="true"
                data-header="Choose starting point:">
                {% for node in nodeDict %}
                    {% if nodeDict[node]['type'] == 'Building' %}
                        <option value="{{ node }}">{{  nodeDict[node]['name']  }}</option>
                    {% endif %}
                {% endfor %}
            </select>
        </div>

        <div class="choose">Choose destination:</div>
        <div class="form-group">
            <select class="selectpicker show-tick" name="end" data-live-search="true" data-header="Choose starting point:">
                {% for node in nodeDict %}
                    {% if nodeDict[node]['type'] == 'Building' %}
                        <option value="{{ node }}">{{  nodeDict[node]['name']  }}</option>
                    {% endif %}
                {% endfor %}
            </select>
        </div>

        <div class="form-group">
            <button class="btn btn-primary">Go!</button>
        </div>
    </form>

    <h4>
        <small class="font-italic"><br>Unsure where you are? Click on the location icon in the top right corner!</small>
    </h4>

    <div id='map_home' class="rounded mx-auto d-block"></div>
    <script>
        mapboxgl.accessToken = 'pk.eyJ1IjoiaHVhaXplIiwiYSI6ImNrYXhsdjh0bzA1YnEycnQ5Z3VoMWM0YWQifQ.THTNfZzuDdUesqxUOBpNLw';
        // Check if browser supports Mapbox
        if (!mapboxgl.supported()) {
            alert('Your browser does not support Mapbox GL');
        }
        else {
            var map = new mapboxgl.Map({
                container: 'map_home', // container id
                style: 'mapbox://styles/mapbox/streets-v11',
                center: [103.77673, 1.29759], // starting position
                zoom: 14 // starting zoom
            });

            var nodeArr_js = {{ nodeArr| tojson
        }};

        for (node of nodeArr_js) {
            var marker = new mapboxgl.Marker()
                .setLngLat([node[3], node[2]])
                .setPopup(new mapboxgl.Popup({ closeButton: false }).setText(node[1]))
                .addTo(map);
        }

        // Add geolocate control to the map.
        map.addControl(
            new mapboxgl.GeolocateControl({
                positionOptions: {
                    enableHighAccuracy: true
                },
                trackUserLocation: true
            })
        );

        // Fullscreen option
        map.addControl(new mapboxgl.FullscreenControl());

        } // do not remove this close bracket
    </script>

{% endblock %}